#mongodb.conf - generated from Puppet

<% config = {'systemLog' => @system_log_config} -%>
<%= config.to_yaml %>

#Process Management
<% if @fork or @pidfilepath -%>
processManagement:
  <%- if @fork -%>
  fork: <%= @fork %>
  <%- end -%>
  <%- if @pidfilepath -%>
  pidFilePath: <%= @pidfilepath %>
  <%- end -%>
<% end -%>

#Storage
storage.dbPath: <%= @dbpath %>
<% if @journal != nil -%>
storage.journal.enabled: <%= @journal %>
<% end -%>
<% if @noprealloc -%>
storage.preallocDataFiles: <%= !@noprealloc %>
<% end -%>
<% if @nssize -%>
storage.nsSize: <%= @nssize %>
<% end -%>
<% if @directoryperdb -%>
storage.directoryPerDB: <%= @directoryperdb %>
<% end -%>
<% if @smallfiles -%>
storage.smallFiles: <%= @smallfiles %>
<% end -%>
<% if @quota -%>
storage.quota.enforced: <%= @quota %>
<% if @quotafiles -%>
storage.quota.maxFilesPerDB: <%= @quotafiles %>
<% end -%>
<% end -%>
<% if @storage_engine_internal -%>
storage.engine: <%= @storage_engine_internal %>
<% end -%>


#Security
<% if @auth -%>
security.authorization: enabled
<% else -%>
security.authorization: disabled
<% end -%>
<% if @keyfile -%>
security.keyFile: <%= @keyfile %>
<% end -%>
<% if @noscripting -%>
security.javascriptEnabled: <%= @noscripting %>
<% end -%>


#Net
<% if @ipv6 -%>
net.ipv6: <%= @ipv6 %>
<% end -%>
<% if @bind_ip -%>
net.bindIp:  <%= @bind_ip.join(',') %>
<% end -%>
<% if @port -%>
net.port: <%= @port %>
<% end -%>
<% if @objcheck -%>
net.wireObjectCheck: <%= @objcheck %>
<% end -%>
<% if @rest -%>
net.http.RESTInterfaceEnabled: true
<% end -%>
<% if @maxconns -%>
net.maxIncomingConnections: <%= @maxconns %>
<% end -%>
<% if ! @nohttpinterface.nil? -%>
net.http.enabled: <%= ! @nohttpinterface %>
<% end -%>
<% if @tls -%>
net.tls.mode: <%= @tls_mode %>
net.tls.certificateKeyFile: <%= @tls_key %>
<% if @tls_ca -%>
net.tls.CAFile: <%= @tls_ca %>
<% end -%>
<% if @tls_conn_without_cert -%>
net.tls.allowConnectionsWithoutCertificates: <%= @tls_conn_without_cert %>
<% end -%>
<% if @tls_invalid_hostnames -%>
net.tls.allowInvalidHostnames: <%= @tls_invalid_hostnames %>
<% end -%>
<% end -%>

#Replication
<% if @replset -%>
replication.replSetName: <%= @replset %>
<% end -%>
<% if @oplog_size -%>
replication.oplogSizeMB: <%= @oplog_size %>
<% end -%>

#Sharding
<% if @configsvr -%>
sharding.clusterRole: configsvr
<% end -%>
<% if @shardsvr -%>
sharding.clusterRole: shardsvr
<% end -%>

#Operation Profiling
<% if @profile == "0" -%>
operationProfiling.mode: off
<% elsif @profile == "1" -%>
operationProfiling.mode: slowOp
<% elsif @profile == "2" -%>
operationProfiling.mode: all
<% end -%>
<% if @slowms -%>
operationProfiling.slowOpThresholdMs: <%= @slowms %>
<% end -%>

<% if @set_parameter -%>
setParameter:
<% [@set_parameter].flatten.each do |v| -%>
  <%= v %>
<% end -%>
<% end -%>

<% if @config_data -%>
<% @config_data.each do |k,v| -%>
<%= k %>: <%= v %>
<% end -%>
<% end -%>
